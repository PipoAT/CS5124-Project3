<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="../favicon.png" type="image/png">
  <title>Breaking Bad Analysis</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min.js"></script>
  <style>
    .dropdown { margin: 10px; }
    #barChart svg, #wordCloud svg { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Breaking Bad</h1>
  <h2>Character Importance & Word Usage in <i>Breaking Bad</i></h2> <p><strong>Breaking Bad</strong> is a critically acclaimed American television drama that aired on AMC 
    from 2008 to 2013. The show spans 5 seasons and 62 episodes, and is widely recognized as one of the greatest TV series of all time.</p> <p>Set in Albuquerque, New Mexico, 
    the series chronicles the transformation of <strong>Walter White</strong>, a struggling high school chemistry teacher diagnosed with terminal cancer, into the ruthless 
    drug kingpin known as "Heisenberg." Alongside him is his former student and partner, <strong>Jesse Pinkman</strong>, who navigates the chaos of the methamphetamine trade. 
    Other key characters include <strong>Skyler White</strong> (Walter’s wife), <strong>Hank Schrader</strong> (Walter’s brother-in-law and DEA agent), <strong>Saul Goodman</strong> 
    (a criminal lawyer), and <strong>Gustavo "Gus" Fring</strong> (a drug distributor posing as a legitimate businessman).</p> <p><strong>Breaking Bad</strong> blends elements of <em>
    crime, thriller, and drama</em>, exploring themes of morality, identity, and consequence. The show's rich storytelling and complex character development make it an 
    excellent subject for analysis. This project uses episode transcripts to explore character importance and word usage throughout the series. 
    Visualizations and data-driven insights help highlight each character’s role and evolution across the seasons.</p>
  </h2>

  <label for="season">Select a season:</label>
  <select id="season" class="dropdown"></select>

  <label for="character">Select a character:</label>
  <select id="character" class="dropdown"></select>

  <div id="barChart"></div>
  <h2>What Does This Character Say?</h2>
  <div id="wordCloud"></div>

  <script>
    const dataFolder = './data/';
    const seasonSelect = document.getElementById('season');
    const characterSelect = document.getElementById('character');

    const seasonFiles = {
      "Season 1": ["Pilot.txt", "Cat's_in_the_Bag.txt", "…"],
      "Season 2": ["Seven_Thirty-Seven.txt", "Grilled.txt", "…"],
      // Add rest of seasons here manually or generate dynamically from filenames
    };

    let characterLines = {};  // { character: [lines] }

    // Populate season dropdown
    Object.keys(seasonFiles).forEach(season => {
      const option = document.createElement("option");
      option.value = season;
      option.text = season;
      seasonSelect.appendChild(option);
    });

    // When a season is selected, load all its transcripts
    seasonSelect.addEventListener("change", async () => {
      const season = seasonSelect.value;
      const files = seasonFiles[season];

      characterLines = {};
      for (const file of files) {
        const text = await fetch(dataFolder + file).then(res => res.text());

        text.split("\n").forEach(line => {
          const match = line.match(/^([A-Z][A-Z\s]+):\s*(.*)/);
          if (match) {
            const name = match[1].trim();
            const words = match[2].trim();
            if (!characterLines[name]) characterLines[name] = [];
            characterLines[name].push(words);
          }
        });
      }

      updateCharacterDropdown();
      renderBarChart();
    });

    // Populate character dropdown based on loaded season
    function updateCharacterDropdown() {
      characterSelect.innerHTML = '';
      Object.keys(characterLines).forEach(char => {
        const option = document.createElement("option");
        option.value = char;
        option.text = char;
        characterSelect.appendChild(option);
      });
    }

    // Render bar chart of line counts
    function renderBarChart() {
      d3.select("#barChart").html("");
      const data = Object.entries(characterLines).map(([name, lines]) => ({
        name,
        count: lines.length
      })).sort((a, b) => b.count - a.count).slice(0, 10); // Top 10

      const width = 600, height = 400;
      const svg = d3.select("#barChart")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      const x = d3.scaleBand()
        .domain(data.map(d => d.name))
        .range([50, width - 20])
        .padding(0.1);

      const y = d3.scaleLinear()
        .domain([0, d3.max(data, d => d.count)])
        .range([height - 40, 20]);

      svg.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("x", d => x(d.name))
        .attr("y", d => y(d.count))
        .attr("width", x.bandwidth())
        .attr("height", d => height - 40 - y(d.count))
        .attr("fill", "steelblue");

      svg.selectAll("text.label")
        .data(data)
        .enter()
        .append("text")
        .attr("class", "label")
        .attr("x", d => x(d.name) + x.bandwidth() / 2)
        .attr("y", d => y(d.count) - 5)
        .attr("text-anchor", "middle")
        .text(d => d.count);

      svg.selectAll("text.name")
        .data(data)
        .enter()
        .append("text")
        .attr("x", d => x(d.name) + x.bandwidth() / 2)
        .attr("y", height - 10)
        .attr("text-anchor", "middle")
        .text(d => d.name);
    }

    // Word cloud for selected character
    characterSelect.addEventListener("change", () => {
      const name = characterSelect.value;
      const words = characterLines[name]?.join(" ").split(/\s+/).map(w => w.toLowerCase());
      const freq = {};
      words.forEach(w => {
        if (!w.match(/^[a-z]+$/)) return;
        freq[w] = (freq[w] || 0) + 1;
      });

      const data = Object.entries(freq)
        .map(([word, size]) => ({ text: word, size }))
        .sort((a, b) => b.size - a.size)
        .slice(0, 100); // top 100 words

      d3.select("#wordCloud").html("");

      const layout = d3.layout.cloud()
        .size([600, 400])
        .words(data)
        .padding(5)
        .rotate(() => 0)
        .fontSize(d => Math.sqrt(d.size) * 6)
        .on("end", draw);

      layout.start();

      function draw(words) {
        d3.select("#wordCloud").append("svg")
          .attr("width", 600)
          .attr("height", 400)
          .append("g")
          .attr("transform", "translate(300,200)")
          .selectAll("text")
          .data(words)
          .enter()
          .append("text")
          .style("font-size", d => `${d.size}px`)
          .style("fill", () => `hsl(${Math.random() * 360}, 70%, 50%)`)
          .attr("text-anchor", "middle")
          .attr("transform", d => `translate(${d.x},${d.y})rotate(${d.rotate})`)
          .text(d => d.text);
      }
    });

  </script>
</body>
</html>
